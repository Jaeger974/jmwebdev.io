<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register New Account</title>
<link rel="stylesheet" href="css/payment.css"/> 
</head>
<body>

<%- include("partials/PS_header.ejs") %>

<div class="payment-container">
    <h2 class="payment-title">Payment Page</h2>
    <form action="/payment" method="POST">

        <div class="form-group">
            <input type="text" id="name-on-card" name="name_on_card" placeholder=" " required>
            <label for="name-on-card" class="form-label">Name on Card</label>
        </div>

        <div class="form-group">
            <input type="text" id="card-number" name="card_number" maxlength="16" placeholder=" " required pattern="^\d{16}$">
            <label for="card-number" class="form-label">Card Number</label>
        </div>

        <div class="form-group">
            <input type="text" id="expiry" name="expiry" maxlength="5" placeholder=" " required pattern="^(0[1-9]|1[0-2])\/\d{2}$">
            <label for="expiry" class="form-label">MM/YY</label>
            <small id="expiryError" class="error-message"></small>
        </div>

        <div class="form-group">
            <input type="text" id="cvv" name="cvv" maxlength="3" placeholder=" " required pattern="^\d{3}$">
            <label for="cvv" class="form-label">CVV</label>
        </div>

        <button type="submit" class="btn-primary">Submit Payment</button>

    </form>


<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" src="/Clientside_JS/PoetrySub.js" type="module"></script>

<script>

const expiryInput = document.getElementById("expiry");
const errorMsg = document.getElementById("expiryError");

expiryInput.addEventListener("input", function (e) {
  let value = this.value.replace(/\D/g, ""); // remove non-digits

  // Auto-insert slash after 2 digits
  if (value.length >= 3) {
    value = value.slice(0, 2) + "/" + value.slice(2);
  }

  this.value = value;

  // Validate only when full MM/YY entered
  if (value.length === 5) {
    const [monthStr, yearStr] = value.split("/");
    const month = parseInt(monthStr, 10);
    const year = parseInt(yearStr, 10);

    if (month < 1 || month > 12) {
      errorMsg.textContent = "Invalid month.";
      return;
    }

    const now = new Date();
    const currentMonth = now.getMonth() + 1;
    const currentYear = now.getFullYear() % 100; // last two digits

    if (year < currentYear || (year === currentYear && month < currentMonth)) {
      errorMsg.textContent = "Expiry date must be in the future.";
    } else {
      errorMsg.textContent = ""; // valid
    }
  } else {
    errorMsg.textContent = ""; // clear until full input
  }
});
</script>

<script>


</script>

<%- include("partials/PS_footer.ejs") %>

</body>
</html>